(function (a) {
	a.fn.nthTabs = function (c) {
		var h = this;
		var g = {
			allowClose: true,
			active: false,
			rollWidth: h.width() - 120,
		};
		var e = a.extend({},
			g, c);
		var d = '<div class="page-tabs"><a href="#"class="roll-nav roll-nav-left"><span class="fa fa-backward"></span></a><div class="content-tabs"><div class="content-tabs-container"><ul class="nav nav-tabs"></ul></div></div><a href="#"class="roll-nav roll-nav-right"><span class="fa fa-forward"></span></a><div class="dropdown roll-nav right-nav-list"><a href="#"class="dropdown-toggle"data-toggle="dropdown"role="button"aria-haspopup="true"aria-expanded="false"><span class="fa fa-chevron-down"></span></a><ul class="dropdown-menu"><li><a href="#"class="tab-add">\u6dfb\u52a0\u9009\u9879\u5361</a></li><li><a href="#"class="tab-edt">\u4fee\u6539\u9009\u9879\u5361</a></li><li role="separator"class="divider"><li><a href="#"class="tab-location">\u5b9a\u4f4d\u5f53\u524d\u9009\u9879\u5361</a></li><li><a href="#"class="tab-close-current">\u5173\u95ed\u5f53\u524d\u9009\u9879\u5361</a></li><li role="separator"class="divider"></li><li><a href="#"class="tab-close-other">\u5173\u95ed\u5176\u4ed6\u9009\u9879\u5361</a></li><li><a href="#"class="tab-close-all">\u5173\u95ed\u5168\u90e8\u9009\u9879\u5361</a></li><li role="separator"class="divider"></li><li class="scrollbar-outer tab-list-scrollbar"><div class="tab-list-container"><ul class="tab-list"></ul></div></li></ul></div></div><div class="tab-content"style="height:100%"></div>';
		var b = {
			init: function () {
				h.html(d);
				b.listen()
			},
			listen: function () {
				f.onTabAdd().onTabAddCheck().onTabEdt().onTabEdtCheck().onTabClose().onTabRollLeft().onTabRollRight().onTabList().onTabCloseOpt().onTabCloseAll().onTabCloseOther().onLocationTab()
			},
			getAllTabWidth: function () {
				var i = 0;
				h.find(".nav-tabs li").each(function () {
					i += parseFloat(a(this).width())
				});
				return i
			},
			getMarginStep: function () {
				return e.rollWidth / 2
			},
			getActiveId: function () {
				return h.find('li[class="active"]').find("a").attr("href").replace("#", "")
			},
			getTabList: function () {
				var i = [];
				h.find(".nav-tabs li a").each(function () {
					i.push({
						id: a(this).attr("href"),
						title: a(this).children("span").html()
					})
				});
				return i
			},
			addTab: function (j) {
				var k = [];
				var m = j.active == undefined ? e.active : j.active;
				var i = j.allowClose == undefined ? e.allowClose : j.allowClose;
				m = m ? "active" : "";
				k.push('<li role="presentation" class="' + m + '">');
				k.push('<a href="#' + j.id + '" data-toggle="tab">');
				k.push("<span>" + j.title + "</span>");
				i ? k.push('<i class="fa fa-close tab-close"></i>') : "";
				k.push("</a>");
				k.push("</li>");
				h.find(".nav-tabs").append(k.join(""));
				var l = [];
				l.push('<div class="tab-pane ' + m + '" id="' + j.id + '" style="height:100%"><textarea class="form-control" style="height:100%">');
				l.push(j.content);
				l.push("</textarea></div>");
				h.find(".tab-content").append(l.join(""));
				return b
			},
			edtTab: function (j, name) {
				var id = b.getActiveId();
				var oldtext = $('#'+id).find('textarea').val();
				this.delTab(j);
				this.addTab({
					id: id,
					title: name,
					content: name
				});
				this.setActTab(id).locationTab(id);
				$('#'+id).find('textarea').text(oldtext);
				return b
			},
			locationTab: function (j) {
				j = j == undefined ? b.getActiveId() : j;
				j = j.indexOf("#") > -1 ? j : "#" + j;
				var m = h.find("[href='" + j + "']");
				var l = 0;
				m.parent().prevAll().each(function () {
					l += a(this).width()
				});
				var i = m.parent().parent().parent();
				if (l <= e.rollWidth * 0.7) {
					margin_left_total = 40
				} else {
					if (l <= e.rollWidth) {
						margin_left_total = 40 - e.rollWidth / 2
					} else {
						var k = l + m.parent().width() - (Math.floor(l / e.rollWidth) * e.rollWidth);
						if (k <= e.rollWidth * 0.7) {
							margin_left_total = 40 - Math.floor(l / e.rollWidth) * e.rollWidth
						} else {
							margin_left_total = 40 - Math.floor(l / e.rollWidth) * e.rollWidth - e.rollWidth / 2
						}
					}
				}
				i.css("margin-left", margin_left_total);
				return b
			},
			delTab: function (j) {
				j = j == undefined ? b.getActiveId() : j;
				j = j.indexOf("#") > -1 ? j : "#" + j;
				var k = h.find("[href='" + j + "']");
				if (k.parent().attr("class") == "active") {
					var i = k.parent().next();
					var l = a(j).next();
					if (i.length < 1) {
						i = k.parent().prev();
						l = a(j).prev()
					}
					i.addClass("active");
					l.addClass("active")
				}
				k.parent().remove();
				a(j).remove();
				return b
			},
			delOtherTab: function () {
				h.find(".nav-tabs li").not('[class="active"]').remove();
				h.find(".tab-content div").not('[class="tab-pane active"]').remove();
				return b
			},
			delAllTab: function () {
				h.find(".nav-tabs li").remove();
				h.find(".tab-content div").remove();
				return b
			},
			setActTab: function (i) {
				i = i == undefined ? b.getActiveId() : i;
				i = i.indexOf("#") > -1 ? i : "#" + i;
				h.find(".active").removeClass("active");
				h.find("[href='" + i + "']").parent().addClass("active");
				h.find(i).addClass("active");
				return b
			},
		};
		var f = {
			onTabAdd: function () {
				h.on("click", ".tab-add",
					function () {
						$('#alertBox').remove();
						var html = "<div id=\'alertBox\'class=\'form-group\'style=\'display:none;margin:20px;\'><dl><dt><input type=\'text\'class=\'form-control\'id=\'name\'placeholder=\'请输入名称\'></dt><dd style=\'margin-top:20px;text-align:center\'><button type=\'button\'class=\'btn btn-primary tab-add-check\'style=\'width:120px\'>确定</button></dd></dl></div>";
						$('body').append(html);
						$('#name').val('');
						layer.open({
							type: 1,
							skin: 'layer-ext-moon', //加上边框
							area: ['500px', '170px'], //宽高
							content: $('#alertBox'),
							title: '<b>名称</b>',
						});
					});
				return f
			},
			onTabAddCheck: function () {
				$('body').on('click', '.tab-add-check', function () {
					var name = $('#name').val();
					if (name == '' || name == null) {
						return;
					}
					layer.closeAll();
					var id =(Math.floor(Math.random(1, 10000000000000) * 10000000)).toString();
					b.addTab({
						id: id,
						title: name,
						content: name
					});
					b.setActTab(id).locationTab(id);
				});
				return f
			},
			onTabEdt: function () {
				h.on("click", ".tab-edt",
					function () {
						$('#alertBox').remove();
						var html = "<div id=\'alertBox\'class=\'form-group\'style=\'display:none;margin:20px;\'><dl><dt><input type=\'text\'class=\'form-control\'id=\'name\'placeholder=\'请输入名称\'></dt><dd style=\'margin-top:20px;text-align:center\'><button type=\'button\'class=\'btn btn-primary tab-edt-check\'style=\'width:120px\'>确定</button></dd></dl></div>";
						$('body').append(html);
						var id ='a[href="#' + b.getActiveId()+'"]';
						var oldname = $(id).text();
						$('#name').val(oldname);
						layer.open({
							type: 1,
							skin: 'layer-ext-moon', //加上边框
							area: ['500px', '170px'], //宽高
							content: $('#alertBox'),
							title: '<b>名称</b>',
						});
					});
				return f
			},
			onTabEdtCheck: function () {
				$('body').on('click', '.tab-edt-check', function () {
					var name = $('#name').val();
					if (name == '' || name == null) {
						return;
					}
					var i = a(this).parent().attr("href");
					b.edtTab(i, name)
					layer.closeAll();
				});
				return f
			},
			onLocationTab: function () {
				h.on("click", ".tab-location",
					function () {
						b.locationTab()
					});
				return f
			},
			onTabClose: function () {
				h.on("click", ".tab-close",
					function () {
						var i = a(this).parent().attr("href");
						b.delTab(i)
					});
				return f
			},
			onTabCloseOpt: function () {
				h.on("click", ".tab-close-current",
					function () {
						b.delTab()
					});
				return f
			},
			onTabCloseOther: function () {
				h.on("click", ".tab-close-other",
					function () {
						b.delOtherTab()
					});
				return f
			},
			onTabCloseAll: function () {
				h.on("click", ".tab-close-all",
					function () {
						b.delAllTab()
					});
				return f
			},
			onTabRollLeft: function () {
				h.on("click", ".roll-nav-left",
					function () {
						if (b.getAllTabWidth() <= e.rollWidth) {
							return false
						}
						var i = a(this).parent().find(".content-tabs-container");
						var j = i.css("marginLeft").replace("px", "");
						var k = parseFloat(j) + b.getMarginStep() + 40;
						i.css("margin-left", k > 40 ? 40 : k)
					});
				return f
			},
			onTabRollRight: function () {
				h.on("click", ".roll-nav-right",
					function () {
						if (b.getAllTabWidth() <= e.rollWidth) {
							return false
						}
						var i = a(this).parent().find(".content-tabs-container");
						var j = i.css("marginLeft").replace("px", "");
						var k = parseFloat(j) - b.getMarginStep();
						if (b.getAllTabWidth() - Math.abs(j) <= e.rollWidth) {
							return false
						}
						i.css("margin-left", k)
					});
				return f
			},
			onTabList: function () {
				h.on("click", ".right-nav-list",
					function () {
						var i = b.getTabList();
						var j = [];
						a.each(i,
							function (k, l) {
								j.push('<li class="toggle-tab" style="text-align:center" data-id="' + l.id + '">' + l.title + "</li>")
							});
						h.find(".tab-list").html(j.join(""))
					});
				h.find(".tab-list-scrollbar").scrollbar();
				f.onTabListToggle();
				return f
			},
			onTabListToggle: function () {
				h.on("click", ".toggle-tab",
					function () {
						var i = a(this).data("id");
						b.setActTab(i).locationTab(i)
					});
				return f
			}
		};
		b.init();
		return b
	}
})(jQuery);